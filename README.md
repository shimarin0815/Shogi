# 将棋ゲーム — Single‑File SPA

ガラス調×木目のモダンUIで遊べる**単一HTMLファイル**の将棋アプリです。ブラウザで開くだけ、依存なし。VS Codeでの開発にも最適。

> **注**: 王手・詰みの厳密判定や「打ち歩詰め」は簡易仕様です。友だち対局のマナーでお楽しみください。

---

## 特長

* ✨ **美しいモダンUI**（木目の盤＋グラスモーフィズム）
* ♟️ **ローカル対局**（先手/後手の切替、盤の反転）
* 🔁 **成り/打ち**（強制成り条件・二歩チェック実装）
* 📜 **棋譜ログ**（簡易テキスト）＋ **.txt 書き出し**
* 🔊 **効果音**（Web Audioの“コトン”音、音量調整・ON/OFF）
* 🧠 **CPU対戦**（簡易評価：駒得＋成り＋中央ボーナス）
* 🎨 **テーマ切替**（Classic / Night / Matcha / Sakura）
* ⏪ **Undo/Redo**（スナップショット復元）
* 📄 **単一ファイル**（`shogi.html` だけ）

---

## クイックスタート

1. VS Codeで**新規ファイル** → `shogi.html` として保存
2. 本リポジトリの `shogi.html` の中身を**コピペ**して保存
3. 起動方法

   * ダブルクリックでブラウザ起動
   * または VS Code 拡張 **Live Server** → 右下 **Go Live**

> うまく表示されない場合はブラウザのキャッシュを無効化（ハードリロード）してください。

---

## 遊び方（中2でもOK）

* 自分の駒を**クリック** → **光ったマス**をクリックで移動
* **持ち駒**は、上/下のチップをクリック → **点線のマス**に打つ
* **成り**：

  * 強制成り… 歩/香は最終段、桂は最後2段
  * 任意成り… 上記以外はダイアログで選択
* **ボタン**：新局／一手戻す／やり直す／盤を反転／ログ書き出し／遊び方
* **CPU対戦**：右上で **先手/後手/なし** から選択
* **テーマ/効果音**：右上で切替、音量スライダー対応

---

## カスタマイズ

### テーマ（色）

`<script>` 内 `themes` を編集：

```js
const themes = {
  classic: { a:'#f4f1e9', b:'#e6d9be', accent:'#60a5fa' },
  night:   { a:'#1f2937', b:'#111827', accent:'#a78bfa' },
  matcha:  { a:'#e8f5e9', b:'#c8e6c9', accent:'#34d399' },
  sakura:  { a:'#fff1f2', b:'#ffe4e6', accent:'#fb7185' },
};
```

CSS変数 `--square-a` / `--square-b` / `--accent` に反映されます。

### 効果音

Web Audio APIでワンショット音を生成。音色・長さ・音量は `playClick()` で調整。

### 棋譜ログ書き出し

`exportLog()` が `.txt` を生成します（LF改行）。ファイル名は日時付き。

### CPU（簡易）

* 合法手全探索 → スコアで1手を選択
* スコア要素：捕獲の駒価値 / 成り可能性 / 盤中央ボーナス / 近接度
* ランダム性を少し付与し、同一盤面でも単調になりにくく

> 強化アイデア：1手先読み（ミニマックス）、自玉の安全評価、駒の効きマップなど

---

## 仕様の要点

* 盤: 9×9（一次元配列）
* 駒: `type` / `owner` / `promoted`
* 手番: 先手(S) → 後手(G)トグル
* 合法手: 駒ごとに移動生成、滑走は壁まで、味方ブロック禁止
* 成り: 地帯出入り時に判定（強制成りあり）
* 打ち: 二歩禁止・最終段/最後2段禁止（歩/香/桂）
* 勝敗: **相手の玉を取ると勝利**（簡易）

---

## 開発

### ファイル構成

* `shogi.html` … すべて（HTML/CSS/JS）を1ファイルに同梱

### コーディング規約（軽め）

* 変数/関数は**小さく**・**単機能**に
* DOM取得は最上部で一括
* CSSは変数中心、影やグラデは最小限で

### ビルド/依存

* なし（純ブラウザ実行）

---

## テスト

### 自動（簡易セルフテスト）

起動時、ブラウザのコンソールに自己テスト結果が表示されます。

* ✅ 改行結合（`composeLogText`）がLFで結合される
* ✅ ヘルプ文字列の構造チェック
* ✅ テーマ変数の適用確認

### 手動テスト（チェックリスト）

* [ ] **移動**：先手・後手ともに自駒クリック→ハイライト→移動できる
* [ ] **取る**：相手駒の上に移動で捕獲でき、持ち駒に加わる
* [ ] **成り**：強制成り条件を満たしたら強制、それ以外はダイアログ
* [ ] **打ち**：

  * [ ] 二歩が**禁止**される（同筋に未成の歩がある場合、打てない）
  * [ ] 歩/香は最終段に**打てない**、桂は最後2段に**打てない**
* [ ] **Undo/Redo**：盤面・持ち駒・手番が正しく復元される
* [ ] **盤反転**：盤のみ回転、ステータス表示はそのまま
* [ ] **効果音**：移動/打ち/操作で鳴る、音量とON/OFFが効く
* [ ] **ログ書き出し**：`.txt` がダウンロードされ、行が **LF** で区切られている
* [ ] **CPU対戦**：選択側の手番で自動で指す（応答遅延 \~0.4s）

> 追加テスト案：同一局面でのスコア分布、持ち駒の種類別ドロップ可否、成り後の移動範囲

---

## トラブルシュート

* **“Invalid or unexpected token”**：`exportLog()` の改行は `\n` を使用（修正済み）。古いキャッシュならハードリロード。
* **音が鳴らない**：モバイル/一部ブラウザは**ユーザー操作後**でないと再生不可。何かクリックしてから試す。
* **ダウンロードされない**：ポップアップ/ダウンロード制限を確認。

---

## ブラウザ対応（目安）

* 最新の Chrome / Edge / Firefox / Safari で動作想定
* Web Audio使用（古い環境では音が出ない場合あり）

---

## ロードマップ

* [ ] 王手・自玉放置の禁止（チェック逃れ必須）
* [ ] 詰み判定の追加
* [ ] CPUの先読み（Minimax/Alpha‑Beta）
* [ ] 棋譜の正式形式（KIF等）での入出力
* [ ] モバイル操作最適化（ロングタップ、触覚フィードバック）

---

## ライセンス

リポジトリ方針に合わせて設定してください（例: MIT）。

---

## クレジット

* Design & Dev: **shimarin**
* Debug/Docs: ChatGPT（サポート）

---

## オープンクエスチョン（要件の最終確認）

* ログの改行コードは **LF** 固定で問題ありませんか？
* CPUの思考時間/強さの目安はどの程度を想定しますか？
* ライセンスは何を採用しますか？（未定の場合はMITが一般的）
